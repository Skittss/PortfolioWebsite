"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[408],{59020:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});s(27565);var i=s(46761),a=s(45577),r=s(20791),n=s(39432);const o=s.p+"static/media/waves.014cf10744590cd153db.mp4",l=s.p+"static/media/sines.9909c1c6e2e806b9b194.png",c=s.p+"static/media/hkt.f5629c70e1807fbac0be.png",h=s.p+"static/media/butterfly.364e84a8bae17d6527df.png",d=s.p+"static/media/normals.eb859e830d18b6385cb6.png";s(73017);var p=s(8249),m=s(81122),u=s(95569),x=s(27929);const f=()=>(0,x.jsxs)(u.A,{title:m.Meta.title,thumb:m.Meta.thumb,projectLink:"https://skittss.github.io/FFTOcean/",githubURL:"https://github.com/Skittss/FFTOcean",children:[(0,x.jsx)("h1",{id:"overview",className:"raleway-title",children:"Overview"}),(0,x.jsx)("div",{style:{paddingBottom:"20px",textAlign:"center"},children:(0,x.jsx)("video",{style:{objectFit:"cover",width:"100%"},autoPlay:!0,loop:!0,muted:!0,children:(0,x.jsx)("source",{src:o,type:"video/mp4"})})}),(0,x.jsxs)("p",{children:["Realistic looking water surfaces are not trivial to simulate; Instead we can make approximations of the behaviour of real water to make convincing looking geometry. In this project I implement stylized ocean geometry and shaders on a GPU with WebGL (via Three.js).",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Using the fast Fourier transform (FFT), the computational cost of creating complex wave-like behaviour can be greatly reduced. This is the focus of this project."]}),(0,x.jsx)("br",{}),(0,x.jsx)(i.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}}),(0,x.jsx)("h1",{id:"gerstner",className:"raleway-title",children:"Gerstner Waves"}),(0,x.jsx)("p",{children:"To kick things off, how do we approach modelling a wave surface? At a simplified level, we may think of waves as being some periodic oscillation of a body of water. This is quite an old observation - first formally noted by physicist Franti\u0161ek Josef Gerstner hundreds of years ago. In mathematical terms, this means a wave surface can be approximated by making each point on the surface move in circular motion, or in other words, as a sinusoid."}),(0,x.jsxs)("div",{style:{paddingBottom:"20px",textAlign:"center"},children:[(0,x.jsx)(a.A,{src:l,fallback:"Gerstner Waves Example"}),(0,x.jsx)("p",{style:{fontSize:"0.75em"},children:(0,x.jsxs)("i",{children:["(Example of Gerstner waves for a 2D surface - courtesy of ",(0,x.jsx)("a",{href:"https://catlikecoding.com/unity/tutorials/flow/waves/",target:"_blank",children:"Jasper Flick"}),") "]})})]}),(0,x.jsx)("p",{children:"Note that this model encapsulates not only vertical movement of the surface, but also horizontal movement as well. This is a key observation that lets us build more complex models."}),(0,x.jsx)("br",{}),(0,x.jsx)(i.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}}),(0,x.jsx)("h1",{id:"displacement",className:"raleway-title",children:"Calculating Displacement Maps"}),(0,x.jsxs)("p",{children:[(0,x.jsx)("a",{href:"https://www.researchgate.net/publication/264839743_Simulating_Ocean_Water",children:"Jerry Tessendorf"})," outlined a much more complex model that builds upon the observations of Gerstner waves. In essence, we layer many waves (sinusoids) on top of one another, all of differing directions and frequencies, to create a detailed surface.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"We can think about this mathematically by first starting in the frequency domain of the waves - this way we can model how the frequencies of waves change over time according to physics, then compute an IFFT of the frequencies to transform them into the spacial domain, i.e. the waves we see.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Tessendorf describes this mathematically:",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),(0,x.jsx)("div",{style:{paddingLeft:"3em",paddingRight:"3em",textAlign:"center"},children:(0,x.jsx)(p.A,{children:"$\\large\\displaystyle h(x,t)=\\sum_k\\tilde h(k,t)e^{ik\\cdot x}$"})}),(0,x.jsx)("br",{}),"Note that ",(0,x.jsx)(p.A,{children:"$k$"})," and ",(0,x.jsx)(p.A,{children:"$x$"})," denote two-dimensional vectors.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),(0,x.jsx)(p.A,{children:"$h(x,t)$"})," denotes the displacement of the wave surface at point ",(0,x.jsx)(p.A,{children:"$x$"})," at time ",(0,x.jsx)(p.A,{children:"$t$"}),". We are working with sinusoids, so this is a periodic function, hence the need for a time parameter. We must also note that we need to encapsulate displacement in all 3 primary axes, like horizontal displacement in Gerstner waves, thus this is specifically ",(0,x.jsx)("i",{children:"displacement along an axis"}),". We will end up calculating ",(0,x.jsx)(p.A,{children:"$h(x,t)$"})," for all 3 axes.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),(0,x.jsx)(p.A,{children:"$\\tilde h(k,t)e^{ik\\cdot x}$"})," represents the waves in the frequency domain. ",(0,x.jsx)(p.A,{children:"$e^{ik\\cdot x}$"})," represents the frequency components of the waves as sinusoids. We can see this from Euler's formula: ",(0,x.jsx)(p.A,{children:"$e^{i\\theta}=\\cos\\theta + i\\sin\\theta$"}),". Using complex numbers here simply lets us easily represent lots of sinusoids. Also note that ",(0,x.jsx)(p.A,{children:"$k\\cdot x$"})," tells us the contribution of the sinusoids to the wave at the point ",(0,x.jsx)(p.A,{children:"$x$"})," based on the direction that the waves propagate in, ",(0,x.jsx)(p.A,{children:"$k$"}),", called ",(0,x.jsx)("i",{children:"wind direction"}),".",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Note that we shift the time parameter into the amplitudes of the frequencies, i.e. ",(0,x.jsx)(p.A,{children:"$\\tilde h(k,t)$"}),", instead of making the sinusoids themselves dependent on ",(0,x.jsx)(p.A,{children:"$t$"}),". This makes the expression easy to calculate an IFFT for, which is where the summation comes in.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Lastly, ",(0,x.jsx)(p.A,{children:"$\\tilde h(k,t)$"})," is calculated by generating an initial spectrum of complex amplitudes denoted by ",(0,x.jsx)(p.A,{children:"$\\tilde h_0(k)$"})," by sampling from a Gaussian random distribution (In code this can be done with a ",(0,x.jsx)("i",{children:"box-muller transform"}),"), sampling from a ",(0,x.jsx)("i",{children:"Phillip's spectrum"})," and updating it based on a ",(0,x.jsx)("i",{children:"dispersion relation"})," ",(0,x.jsx)(p.A,{children:"$\\omega$"})," based on physics principles. More details about this can be found in ",(0,x.jsx)("a",{href:"https://www.researchgate.net/publication/264839743_Simulating_Ocean_Water",children:"Tessendorf's paper."})]}),(0,x.jsxs)("div",{style:{paddingBottom:"20px",textAlign:"center",width:"100%",maxWidth:"800px",margin:"0 auto"},children:[(0,x.jsx)(a.A,{src:c,fallback:"Process of calculating h(x,t)"}),(0,x.jsx)("p",{style:{fontSize:"0.75em"},children:(0,x.jsxs)("i",{children:["Process of calculating ",(0,x.jsx)(p.A,{children:"$h(x,t)$"})," - note complex numbers are stored in both the red and green channels. "]})})]}),(0,x.jsx)("br",{}),(0,x.jsx)(i.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}}),(0,x.jsx)("h1",{id:"ifft",className:"raleway-title",children:"IFFT on a GPU"}),(0,x.jsxs)("p",{children:["The next step is calculating the IFFT for the above expression. A naive IDFT would be too slow considering the wave surface consists of many points. Even a CPU-bound IFFT leaves performance on the table. Computing the IFFT on the GPU is the fastest way to do this calculation in this case.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"The way we approach this is by precomputing values of the FFT into a ",(0,x.jsx)("i",{children:"'butterfly texture'"})," for each step of the FFT. You can observe this with the structure of the texture resembling the 'splitting' nature of a Cooley-Tukey FFT. We then invert the FFT using a method outlined by ",(0,x.jsx)("a",{href:"https://doi.org/10.15480/882.1436",children:"FJ-Flugge"}),", overall performing an IFFT2 after both a horizontal and vertical pass. Thus we can calculate the displacement along each primary axis to create our wave surface geometry."]}),(0,x.jsxs)("div",{style:{paddingBottom:"20px",textAlign:"center",width:"25%",minWidth:"300px",margin:"0 auto"},children:[(0,x.jsx)(a.A,{src:h,fallback:"Example butterfly texture"}),(0,x.jsx)("p",{style:{fontSize:"0.75em"},children:(0,x.jsxs)("i",{children:["Example butterfly texture. Note that this is stretched along the x-axis - the texture has dimensions ",(0,x.jsx)(p.A,{children:"$\\log N \\times N$"})]})})]}),(0,x.jsx)("br",{}),(0,x.jsx)(i.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}}),(0,x.jsx)("h1",{id:"lighting",className:"raleway-title",children:"Lighting and Fog"}),(0,x.jsxs)("p",{children:["After generating the displacements of the wave surface and applying them to a plane (via a vertex shader), the surface must be able to react to light so that the displacement can be seen from oblique viewing angles.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"A computationally cheaper abridgement of the Phong Lighting model, the Blinn-Phong lighting model makes this fairly simple. We calculate normal vectors per vertex of the geometry by averaging normal vectors for two neighbouring triangle surfaces. We then use the normals to calculate how light bounces into the camera, which affects shadows (diffuse lighting) and specular highlights."]}),(0,x.jsxs)("div",{style:{paddingBottom:"20px",textAlign:"center",width:"100%",margin:"0 auto"},children:[(0,x.jsx)(a.A,{src:d,fallback:"Normals for wave surface"}),(0,x.jsx)("p",{style:{fontSize:"0.75em"},children:(0,x.jsx)("i",{children:"Visualised normals for wave surface (low resolution as calculated per-fragment for sake of visualization)"})})]}),(0,x.jsx)("p",{children:"A final touch is to add a sense of depth to the surface; we can remove detail at far distances with per-vertex 'fog' to avoid cluttering the image. We simply calculate the distance of each vertex from the camera and divide it through by the maximum fog distance (i.e. where fog is at a maximum) to get a 'fog amount'. This value can then be used to linearly interpolate between the colour of the wave surface (+ lighting) and a specified fog colour, reducing the effects of shadow & specular highlights at far distances."}),(0,x.jsx)("br",{}),(0,x.jsx)(i.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}}),(0,x.jsx)("h1",{id:"improvements",className:"raleway-title",children:"Improvements"}),(0,x.jsx)("p",{children:"Below is a list of potential improvements that could be made to this project given some extra time:"}),(0,x.jsxs)("div",{style:{paddingLeft:"2vw",paddingRight:"2vw"},children:[(0,x.jsxs)(r.A,{style:{display:"flex",paddingBottom:"10px"},children:[(0,x.jsxs)(n.A,{children:[(0,x.jsx)("b",{children:"1. "})," \xa0\xa0\xa0"]}),(0,x.jsxs)(n.A,{flex:"1vw",children:["The FFT implementation using the butterfly texture would really benefit from having the full capabilities of a compute shader - in Three.js we are limited to using the ",(0,x.jsx)("i",{children:"GPUComputationRenderer"})," class to imitate the behaviour. Being able to read from another input buffer for the bit reversed indices needed for Cooley-Tukey FFT would be particularly useful. The ",(0,x.jsx)("a",{href:"https://www.microsoft.com/en-us/research/publication/fast-computation-of-general-fourier-transforms-on-gpus/",children:"Stockham formation"})," of an FFT would probably be better suited for a WebGL implementation, though the inversion code would have to be changed."]})]}),(0,x.jsx)("br",{}),(0,x.jsxs)(r.A,{style:{display:"flex"},children:[(0,x.jsxs)(n.A,{children:[(0,x.jsx)("b",{children:"2. "})," \xa0\xa0\xa0"]}),(0,x.jsx)(n.A,{flex:"1vw",children:"Patches of ocean could be properly tesselated together to eliminate some slightly visible seams in the scene. Alternatively, mesh-instancing could be explored to reduce the performance hit of rendering separate meshes for each patch."})]}),(0,x.jsx)("br",{}),(0,x.jsxs)(r.A,{style:{display:"flex"},children:[(0,x.jsxs)(n.A,{children:[(0,x.jsx)("b",{children:"3. "})," \xa0\xa0\xa0"]}),(0,x.jsxs)(n.A,{flex:"1vw",children:["More accurate surface normals could be calculated via a method outlined in ",(0,x.jsx)("a",{href:"https://www.researchgate.net/publication/264839743_Simulating_Ocean_Water",children:"Tessendorf's paper."})]})]}),(0,x.jsx)("br",{}),(0,x.jsxs)(r.A,{style:{display:"flex"},children:[(0,x.jsxs)(n.A,{children:[(0,x.jsx)("b",{children:"4. "})," \xa0\xa0\xa0"]}),(0,x.jsx)(n.A,{flex:"1vw",children:"Wave choppiness could be more finely tuned and some foam could be added atop the most choppy parts of waves."})]})]})]})},58990:(e,t,s)=>{s.d(t,{A:()=>d});var i=s(27565),a=s(11030),r=s(20477),n=s(58860),o=s(46761),l=s(75342),c=s(85477),h=(s(29780),s(27929));const d=e=>{let{title:t,githubURL:s,projectRoute:d,projectLink:p,thumb:m}=e;const u=(0,a.zy)().pathname;return(0,i.useEffect)((()=>{window.scrollTo(0,0)}),[]),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{style:{marginTop:"-3rem",backgroundImage:"url(".concat(m,")"),backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",height:"100vh",zIndex:-1}}),(0,h.jsxs)("div",{className:"project-home-wrapper",style:{position:"absolute",width:"100%",top:"101vh",left:"0px",transform:"translate(0, -100%)"},children:[(0,h.jsxs)("header",{className:"home-header",children:[(0,h.jsx)("h1",{id:"title",style:{display:"inline-block"},children:t}),(0,h.jsxs)("span",{style:{padding:"0 1em",display:"inline-block"},children:[void 0!=s?(0,h.jsx)(n.A,{title:"View on Github",placement:"bottom",children:(0,h.jsx)("a",{href:s,target:"_blank",children:(0,h.jsx)(l.A,{className:"title-icon"})})}):null,void 0!=d?(0,h.jsx)(n.A,{title:"View project",placement:"bottom",children:(0,h.jsx)(r.N_,{to:u+d,children:(0,h.jsx)(c.A,{className:"title-icon"})})}):null,void 0!=p?(0,h.jsx)(n.A,{title:"View project",placement:"bottom",children:(0,h.jsx)("a",{href:p,target:"_blank",children:(0,h.jsx)(c.A,{className:"title-icon"})})}):null]}),(0,h.jsx)(o.A,{style:{borderTopWidth:"1px",borderTopColor:"#000000",opacity:.5}})]}),(0,h.jsx)("div",{style:{height:"8em"}})]})]})}},95569:(e,t,s)=>{s.d(t,{A:()=>f});var i=s(28370),a=s.n(i),r=s(58990),n=s(65894),o=s(9514),l=s(27565),c=s(27929);const h=e=>{var t=e.filter((e=>{let t=e.nodeName;return"title"!==e.id&&("H1"===t||"H2"===t||"H3"===t)}));let s=-1;var i=t.map((e=>(s++,{key:"contents_".concat(s),href:"#".concat(e.id),title:e.innerHTML,level:parseInt(e.nodeName.slice(-1))}))),a=[],r=[],n=[a];return i.forEach((e=>{var t=r.findIndex((t=>t>=e.level));-1===t?t=r.push(e.level)-1:r.length=t+1,n[t].push(Object.assign({},e,{children:n[t+1]=[]}))})),a},d=e=>{let{title:t}=e;const{nestedHeadings:s}=(()=>{const[e,t]=(0,l.useState)([]);return(0,l.useEffect)((()=>{const e=Array.from(document.querySelectorAll("h1, h2, h3")),s=h(e);t(s)}),[]),{nestedHeadings:e}})(),{navHeight:i}=(()=>{const[e,t]=(0,l.useState)(0);return(0,l.useEffect)((()=>{const e=document.getElementById("main-navbar");console.log(e),t(e.offsetHeight)}),[]),{navHeight:e}})(),[a,r]=(0,l.useState)("85vh");return(0,l.useEffect)((()=>{const e=document.getElementById("toc-breadcrumb");e&&r("calc(100vh - 6rem - ".concat(e.offsetHeight,"px)"))}),[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.A,{id:"toc-breadcrumb",style:{paddingBottom:"14px",position:"sticky"},items:[{title:(0,c.jsx)("a",{href:"#home",children:"Portfolio"})},{title:(0,c.jsx)("a",{href:"#projects",children:"Projects"})},{title:"".concat(t)}]}),(0,c.jsx)(o.A,{style:{maxHeight:a,overflow:"auto"},targetOffset:i,onClick:(e,t)=>{e.preventDefault()},items:s})]})};var p=s(50899),m=s(20791),u=s(39432);const{useBreakpoint:x}=p.Ay,f=e=>{let{title:t,thumb:s,projectLink:i,projectRoute:n,githubURL:o,footer:l,children:h}=e;const p=x();return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(a(),{children:[(0,c.jsx)(r.A,{title:t,thumb:s,projectRoute:n,projectLink:i,githubURL:o}),(0,c.jsxs)(m.A,{gutter:0,children:[(0,c.jsx)(u.A,{xs:0,lg:5,children:(0,c.jsx)("div",{className:"project-toc-wrapper",children:(0,c.jsx)(d,{title:t})})}),(0,c.jsxs)(u.A,{xs:24,lg:19,children:[(0,c.jsx)("div",{className:"project-content-wrapper",style:{marginRight:p.lg?"17.5vw":"6vw",marginLeft:p.lg?0:"6vw"},children:h}),(0,c.jsx)("div",{className:"project-footer-wrapper",style:{display:"flex",justifyContent:"center",marginTop:"8vh",marginBottom:"5vh",marginRight:p.lg?"17.5vw":"6vw",marginLeft:p.lg?0:"6vw"},children:l?{footer:l}:"\u274b That's all! Thanks for reading. \u274b"})]})]})]})})}},29780:()=>{}}]);
//# sourceMappingURL=408.900a177a.chunk.js.map