(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[21],{213:function(e,t,n){},217:function(e,t,n){"use strict";n.r(t);var r=n(18),a=n(0),i=n(510),s=n(518),l=n(136),o=n.n(l),c=n(178),u=n(509),f=n(109),d=n.n(f),m=n(506),h=n(495),v=n(496),g=n(504),x=n(505),j=n(503),b=n(218),p=n(85),O=n(500),y=n(517),S=n(502),w=n(513),D=n(516),U=n(7),C=S.a.Dragger,k=function(e){return e.loading?Object(U.jsx)(O.a,{spin:!0}):Object(U.jsx)(D.a,{})},M=function(e){var t=e.onLoadCallback,n=e.style,i=Object(a.useState)(!1),s=Object(r.a)(i,2),l=s[0],u=s[1],f=function(){var e=Object(c.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.file,r=t.onSuccess,new Promise((function(e){setTimeout((function(){var t=URL.createObjectURL(n),r=new Image;r.onload=function(){e({src:t,dim:{width:r.width,height:r.height}})},r.src=t}),30)})).then((function(e){return r(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(C,{style:n,name:"source-image",multiple:!1,listType:"picture-card",className:"src-img-uploader",showUploadList:!1,customRequest:f,beforeUpload:function(e){return!("image/png"!==e.type&&"image/jpeg"!==e.type)||(w.a.error("Only PNG/JPEG files are supported."),!1)},onChange:function(e){"uploading"===e.file.status?u(!0):"done"===e.file.status?(u(!1),t(e.file.response)):(u(!1),console.log(e.file.status))},children:[Object(U.jsx)("p",{className:"ant-upload-drag-icon",children:Object(U.jsx)(k,{loading:l})}),Object(U.jsx)("p",{className:"ant-upload-text",children:"Click or drag an image to this area to begin"}),Object(U.jsx)("p",{className:"ant-upload-hint",children:"(large images may take a long time to process)"})]})},T=(n(213),n(94)),F=function(e){var t=e.img,n=e.dim,a=Object(u.d)(T.TextureLoader,t);a.minFilter=T.LinearFilter;var i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Object(u.e)(),a=r.viewport,i=r.aspect,s=t*(i>e/t?a.width/e:a.height/t);return[e*(i>e/t?a.width/e:a.height/t)*n,s*n,1]}(n.width,n.height),s=Object(r.a)(i,2),l=s[0],o=s[1];return Object(U.jsxs)("mesh",{scale:[l,o,1],children:[Object(U.jsx)("planeBufferGeometry",{attach:"geometry"}),Object(U.jsx)("meshBasicMaterial",{attach:"material",map:a,depthTest:!1,toneMapped:!1})]})},R=n(486),_=n(479),V=n(96),G=n(102),P=n(106),N=n(107),Q=n(112),B={uniforms:{tDiffuse:{value:null},weights:{value:new T.Vector3}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\t\tuniform float opacity;\n\t\tuniform sampler2D tDiffuse;\n        uniform vec3 weights;\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n            float w_a = weights.x * texel.x + weights.y * texel.y + weights.z * texel.z;\n\t\t\tgl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\t\t}"},A={uniforms:{tDiffuse:{value:null},kernelSize:{value:0},kernel:{value:new Array(128)},hRes:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform float hRes;\n        uniform int kernelSize;\n        uniform float kernel[128];\n        uniform sampler2D tDiffuse;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vec4 color = texture2D(tDiffuse, vUv) * kernel[0];\n\n            for (int i=1; i < 128; i++) {\n                if (i == kernelSize) break;\n                color += texture2D(tDiffuse, vUv + vec2(float(i)/hRes, 0.0)) * kernel[i];\n                color += texture2D(tDiffuse, vUv - vec2(float(i)/hRes, 0.0)) * kernel[i];\n            }\n\n            gl_FragColor = color;\n        }"},z={uniforms:{tDiffuse:{value:null},kernelSize:{value:0},kernel:{value:new Array(128)},vRes:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"            \n        uniform float vRes;\n        uniform int kernelSize;\n        uniform float kernel[128];\n        uniform sampler2D tDiffuse;\n        \n        varying vec2 vUv;\n\n        void main() {\n\n            vec4 color = texture2D(tDiffuse, vUv) * kernel[0];\n\n            for (int i=1; i < 128; i++) {\n                if (i == kernelSize) break;\n                color += texture2D(tDiffuse, vUv + vec2(0.0, float(i)/vRes)) * kernel[i];\n                color += texture2D(tDiffuse, vUv - vec2(0.0, float(i)/vRes)) * kernel[i];\n            }\n\n            gl_FragColor = color;\n        }"},L={uniforms:{tDiffuse:{value:null},dim:{value:new T.Vector2},GX:{value:new Array(9)},GY:{value:new Array(9)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform vec2 dim;\n        uniform float GX[9];\n        uniform float GY[9];\n        uniform sampler2D tDiffuse;\n\n        void main() {\n            \n            vec4 gx = vec4(0.0);\n            vec4 gy = vec4(0.0);\n            vec4 v;\n\n            for (int j=0; j<3; j++) {\n                for (int i=0; i<3; i++) {\n                    v = texture2D(tDiffuse, vec2(gl_FragCoord.x/dim.x, gl_FragCoord.y/dim.y) + vec2( float(i-1)/dim.x, float(j-1)/dim.y ) );\n                    gx += GX[j * 3 + i] * v;\n                    gy += GY[j * 3 + i] * v;\n                }\n            }\n\n            vec4 mag = sqrt(gx * gx + gy * gy);\n            float arg = atan(gy.x, gx.x);\n\n\n            gl_FragColor = vec4(mag.x, mag.y, mag.z, 1.0);\n        }"},I={uniforms:{tDiffuse:{value:null},max:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDiffuse;\n        uniform float max;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            float v = texture2D(tDiffuse, vUv).x;\n            float norm = v / max;\n\n            gl_FragColor = vec4(norm, norm, norm, 1.0);\n\n        }"},Y={uniforms:{tDiffuse:{value:null},max:{value:1},high:{value:0},low:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDiffuse;\n        uniform float max;\n        uniform float high;\n        uniform float low;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            float v = texture2D(tDiffuse, vUv).x;\n\n            vec4 texel;\n            if (v <= low) {\n                texel = vec4(0.0, 0.0, 0.0, 1.0);\n            } else if (v < high) {\n                texel = vec4(0.3, 0.3, 0.3, 1.0);\n            } else {\n                texel = vec4(1.0);\n            }\n\n            gl_FragColor = texel;\n\n        }"},X={uniforms:{tDiffuse:{value:null},dims:{value:new T.Vector2},tolerance:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDiffuse;\n        uniform vec2 dims;\n        uniform int tolerance;\n\n        void main() {\n\n            float v = 0.0;\n            for (int j = -tolerance; j <= tolerance; j++) {\n                for (int i = -tolerance; i <= tolerance; i++) {\n                    \n                    vec2 coord = vec2(gl_FragCoord.x/dims.x, gl_FragCoord.y/dims.y) + vec2( float(i)/dims.x, float(j)/dims.y );\n\n                    if ( texture2D(tDiffuse, coord).x > 0.3) {\n\n                        v = 1.0;\n                        break;\n\n                    }\n\n                }\n            }\n\n            gl_FragColor = vec4(v, v, v, 1.0);\n\n        }"},E={uniforms:{tDilate:{value:null},tDiffuse:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDilate;\n        uniform sampler2D tDiffuse;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            float dilate = texture2D(tDilate, vUv).x;\n            float weak = texture2D(tDiffuse, vUv).x;\n\n            if (weak < 1.0 && weak > 0.0 && dilate > 0.3) {\n\n                weak = 1.0;\n\n            }\n\n            gl_FragColor = vec4(weak, weak, weak, 1.0);\n        }"},H={uniforms:{tDiffuse:{value:null},dims:{value:new T.Vector2}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDiffuse;\n        uniform vec2 dims;\n\n        void main() {\n\n            vec2 coord = vec2(gl_FragCoord.x/dims.x, gl_FragCoord.y/dims.y);\n\n            float v = texture2D(tDiffuse, coord).x;\n            if ( v <= 0.3 ) {\n                v = 0.0;\n            }\n\n            gl_FragColor = vec4(v, v, v, 1.0);\n\n        }"},q={uniforms:{tDiffuse:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n\n        precision highp float;\n\n        uniform sampler2D tDiffuse;\n\n        varying vec2 vUv;\n\n        void main() {\n\n            gl_FragColor = texture2D(tDiffuse, vUv);\n\n        }"},W=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e){var r;Object(V.a)(this,n),r=t.call(this);var a=B;return r.uniforms=T.UniformsUtils.clone(a.uniforms),r.material=new T.ShaderMaterial({uniforms:r.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),void 0!==e&&(r.uniforms.weights.value=e),r.fsQuad=new Q.a(r.material),r}return Object(G.a)(n,[{key:"render",value:function(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}}]),n}(Q.b),J=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e,r,a){var i;Object(V.a)(this,n),i=t.call(this);var s=A;return i.uniforms=T.UniformsUtils.clone(s.uniforms),i.material=new T.ShaderMaterial({uniforms:i.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),void 0!==e&&(i.uniforms.kernel.value=e),void 0!==r&&(i.uniforms.kernelSize.value=r),void 0!==a&&(i.uniforms.hRes.value=a),i.fsQuad=new Q.a(i.material),i}return Object(G.a)(n,[{key:"render",value:function(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}}]),n}(Q.b),K=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e,r,a){var i;Object(V.a)(this,n),i=t.call(this);var s=z;return i.uniforms=T.UniformsUtils.clone(s.uniforms),i.material=new T.ShaderMaterial({uniforms:i.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),void 0!==e&&(i.uniforms.kernel.value=e),void 0!==r&&(i.uniforms.kernelSize.value=r),void 0!==a&&(i.uniforms.vRes.value=a),i.fsQuad=new Q.a(i.material),i}return Object(G.a)(n,[{key:"render",value:function(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}}]),n}(Q.b),Z=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e,r,a){var i;Object(V.a)(this,n),i=t.call(this);var s=L;return i.uniforms=T.UniformsUtils.clone(s.uniforms),i.material=new T.ShaderMaterial({uniforms:i.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),void 0!==e&&(i.uniforms.GX.value=e),void 0!==r&&(i.uniforms.GY.value=r),void 0!==a&&(i.uniforms.dim.value=a),i.fsQuad=new Q.a(i.material),i}return Object(G.a)(n,[{key:"render",value:function(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}}]),n}(Q.b),$=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e,r,a,i,s){var l;return Object(V.a)(this,n),(l=t.call(this)).doNMS=i,l.threshold=s,l.dims=a,l.gpuCompute=e.gpuCompute,l.magnitudeVariable=e.magnitudeVariable,l.magnitudeUniforms=e.magnitudeUniforms,l.argumentVariable=e.argumentVariable,l.argumentUniforms=e.argumentUniforms,i&&(l.nmsGpuCompute=r.nmsGpuCompute,l.nmsVariable=r.nmsVariable,l.nmsUniforms=r.nmsUniforms),l.initNormalizeShader(),s&&l.initThresholdShader(),l}return Object(G.a)(n,[{key:"render",value:function(e,t,n){var r;this.magnitudeUniforms.tDiffuse.value=n.texture,this.doNMS&&(this.argumentUniforms.tDiffuse.value=n.texture),this.gpuCompute.compute(),this.doNMS?(this.nmsUniforms.tMags.value=this.gpuCompute.getCurrentRenderTarget(this.magnitudeVariable).texture,this.nmsUniforms.tArgs.value=this.gpuCompute.getCurrentRenderTarget(this.argumentVariable).texture,this.nmsUniforms.dim.value=this.dims,this.nmsGpuCompute.compute(),r=this.nmsGpuCompute.getCurrentRenderTarget(this.nmsVariable)):r=this.gpuCompute.getCurrentRenderTarget(this.magnitudeVariable);var a=new Float32Array(4*this.dims[0]*this.dims[1]);e.readRenderTargetPixels(r,0,0,this.dims[0],this.dims[1],a);for(var i=0,s=0;s<a.length;s+=4)a[s]>i&&(i=a[s]);if(i>0&&(this.normUniforms.max.value=i),this.normUniforms.tDiffuse.value=r.texture,this.renderToScreen&&!this.threshold?(e.setRenderTarget(null),this.normFsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(),this.normFsQuad.render(e)),this.threshold){var l=this.threshold.high*i;this.threshUniforms.tDiffuse.value=n.texture,this.threshUniforms.max.value=i,this.threshUniforms.high.value=l,this.threshUniforms.low.value=this.threshold.low*l,this.renderToScreen?(e.setRenderTarget(null),this.threshFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.threshFsQuad.render(e))}}},{key:"initNormalizeShader",value:function(){var e=I;this.normUniforms=T.UniformsUtils.clone(e.uniforms),this.normMaterial=new T.ShaderMaterial({uniforms:this.normUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.normFsQuad=new Q.a(this.normMaterial)}},{key:"initThresholdShader",value:function(){var e=Y;this.threshUniforms=T.UniformsUtils.clone(Y.uniforms),this.threshMaterial=new T.ShaderMaterial({uniforms:this.threshUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.threshFsQuad=new Q.a(this.threshMaterial)}}]),n}(Q.b),ee=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e,r,a,i){var s;return Object(V.a)(this,n),(s=t.call(this)).iterations=r,0==r&&s.initCopyShader(),s.initDilationShader(i,e),s.initHysteresisShader(),s}return Object(G.a)(n,[{key:"render",value:function(e,t,n){if(this.intermediateRt=t.clone(),0==this.iterations)this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.copyFsQuad.render(e);else{this.hysUniforms.tDiffuse.value=n.texture;for(var r=0;r<this.iterations;r++)this.uniforms.tDiffuse.value=0==r?n.texture:t.texture,e.setRenderTarget(this.intermediateRt),this.clear&&e.clear(),this.fsQuad.render(e),this.hysUniforms.tDilate.value=this.intermediateRt.texture,r==this.iterations-1&&this.renderToScreen?(e.setRenderTarget(null),this.hysFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.hysFsQuad.render(e))}this.intermediateRt.dispose(),delete this.intermediateRt}},{key:"initCopyShader",value:function(){var e=q;this.copyUniforms=T.UniformsUtils.clone(e.uniforms),this.copyMaterial=new T.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.copyFsQuad=new Q.a(this.copyMaterial)}},{key:"initDilationShader",value:function(e,t){var n=X;this.uniforms=T.UniformsUtils.clone(n.uniforms),this.material=new T.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),void 0!==e&&(this.uniforms.dims.value=e),void 0!==t&&(this.uniforms.tolerance.value=t),this.fsQuad=new Q.a(this.material)}},{key:"initHysteresisShader",value:function(){var e=E;this.hysUniforms=T.UniformsUtils.clone(e.uniforms),this.hysMaterial=new T.ShaderMaterial({uniforms:this.hysUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.hysFsQuad=new Q.a(this.hysMaterial)}}]),n}(Q.b),te=function(e){Object(P.a)(n,e);var t=Object(N.a)(n);function n(e){var r;return Object(V.a)(this,n),(r=t.call(this)).initCopyShader(),null!==e&&(r.copyUniforms.dims.value=e),r}return Object(G.a)(n,[{key:"render",value:function(e,t,n){this.copyUniforms.tDiffuse.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.copyFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.copyFsQuad.render(e))}},{key:"initCopyShader",value:function(){var e=H;this.copyUniforms=T.UniformsUtils.clone(e.uniforms),this.copyMaterial=new T.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.copyFsQuad=new Q.a(this.copyMaterial)}}]),n}(Q.b),ne=n(2),re=n(480),ae=function(e){for(var t=e.image.data,n=0;n<t.length;n++)t[n]=0},ie=function(e,t,n,r){var a,i=new re.a(t[0],t[1],e),s=i.createTexture();ae(s);var l,o,c=i.addVariable("textureMagnitude","\n    precision highp float;\n\n    uniform vec2 dim;\n    uniform float GX[9];\n    uniform float GY[9];\n    uniform sampler2D tDiffuse;\n\n    void main() {\n        \n        vec4 gx = vec4(0.0);\n        vec4 gy = vec4(0.0);\n        vec4 v;\n\n        for (int j=0; j<3; j++) {\n            for (int i=0; i<3; i++) {\n                v = texture2D(tDiffuse, vec2(gl_FragCoord.x/dim.x, gl_FragCoord.y/dim.y) + vec2( float(i-1)/dim.x, float(j-1)/dim.y ) );\n                gx += GX[j * 3 + i] * v;\n                gy += GY[j * 3 + i] * v;\n            }\n        }\n\n        vec4 mag = sqrt(gx * gx + gy * gy);\n        gl_FragColor = vec4(mag.x, mag.y, mag.z, 1.0);\n    }",s);r?(o=i.createTexture(),ae(o),l=i.addVariable("textureArgument","\n    precision highp float;\n\n    uniform vec2 dim;\n    uniform float GX[9];\n    uniform float GY[9];\n    uniform sampler2D tDiffuse;\n\n    void main() {\n        \n        vec4 gx = vec4(0.0);\n        vec4 gy = vec4(0.0);\n        vec4 v;\n\n        for (int j=0; j<3; j++) {\n            for (int i=0; i<3; i++) {\n                v = texture2D(tDiffuse, vec2(gl_FragCoord.x/dim.x, gl_FragCoord.y/dim.y) + vec2( float(i-1)/dim.x, float(j-1)/dim.y ) );\n                gx += GX[j * 3 + i] * v;\n                gy += GY[j * 3 + i] * v;\n            }\n        }\n\n        vec4 mag = sqrt(gx * gx + gy * gy);\n        float arg = atan(gy.x, gx.x);\n\n        gl_FragColor = vec4(arg, arg, arg, arg);\n    }",o),i.setVariableDependencies(c,[l,c]),i.setVariableDependencies(l,[l,c])):i.setVariableDependencies(c,[c]);var u,f=c.material.uniforms;f.GX={value:n.gx},f.GY={value:n.gy},f.dim={value:t},f.tDiffuse={value:null},r&&((u=l.material.uniforms).GX={value:n.gx},u.GY={value:n.gy},u.dim={value:t},u.tDiffuse={value:null});var d=i.init();return null!==d?(console.error(d),null):(a={gpuCompute:i,magnitudeVariable:c,magnitudeUniforms:f},Object(ne.a)(a,"magnitudeUniforms",f),Object(ne.a)(a,"argumentVariable",l),Object(ne.a)(a,"argumentUniforms",u),Object(ne.a)(a,"texture",o),Object(ne.a)(a,"texture_2",s),a)},se=function(e,t,n){if(!n)return null;var r=new re.a(t[0],t[1],e),a=r.createTexture();ae(a);var i=r.addVariable("textureNms","\n\n    uniform sampler2D tMags;\n    uniform sampler2D tArgs;\n    uniform vec2 dim;\n\n    void main() {\n        \n        vec2 current = vec2(gl_FragCoord.x/dim.x, gl_FragCoord.y/dim.y);\n\n        float m = texture2D(tMags, current).x;\n        float a = texture2D(tArgs, current).x;\n\n        float hComp = cos(a);\n        float vComp = sin(a);\n        float xTranslate = sign(hComp);\n        float yTranslate = sign(vComp);\n\n        vec2 translate = vec2(xTranslate/dim.x, yTranslate/dim.y);\n        vec2 a1 = current + translate;\n        vec2 a2 = current - translate;\n        float ag1 = texture2D(tMags, a1).x;\n        float ag2 = texture2D(tMags, a2).x;\n\n        vec2 b1, b2;\n        float bg1, bg2;\n\n        float g1, g2;\n\n        if (abs(hComp) > abs(vComp)) {\n            translate = vec2(xTranslate/dim.x, 0.0);\n            b1 = current + vec2(translate);\n            b2 = current - vec2(translate);\n            bg1 = texture2D(tMags, b1).x;\n            bg2 = texture2D(tMags, b2).x;\n            g1 = ag1 * abs(vComp) + (1.0-abs(vComp)) * bg1;\n            g2 = ag2 * abs(vComp) + (1.0-abs(vComp)) * bg2;\n        }\n        else {\n            translate = vec2(0.0, yTranslate/dim.y);\n            b1 = current + vec2(translate);\n            b2 = current - vec2(translate);\n            bg1 = texture2D(tMags, b1).x;\n            bg2 = texture2D(tMags, b2).x;\n            g1 = ag1 * abs(hComp) + (1.0-abs(hComp)) * bg1;\n            g2 = ag2 * abs(hComp) + (1.0-abs(hComp)) * bg2;\n        }\n\n        if (g1 > m || g2 > m) {\n            m = 0.0;\n        }\n\n        gl_FragColor = vec4(m, m, m, 1.0);\n\n    }",a);r.setVariableDependencies(i,[i]);var s=i.material.uniforms;s.dim={value:t},s.tMags={value:null},s.tArgs={value:null};var l=r.init();return null!==l?(console.error(l),null):{nmsGpuCompute:r,nmsVariable:i,nmsUniforms:s,textures:[a]}},le=function(e,t,n,r){return{sobel:ie(e,t,n,r),nms:se(e,t,r)}},oe=function(e,t){for(var n,r=0,a=[],i=1/(Math.sqrt(2*Math.PI)*t),s=0;s<=e;s++)n=Math.exp(-Math.pow(s,2)/(2*Math.pow(t,2))),a[s]=i*n,r+=0===s?a[s]:2*a[s];for(var l=0;l<=e;l++)a[l]/=r;return a};Object(u.b)({EffectComposer:R.a,RenderPass:_.a,GrayscalePass:W,HorizontalBlurPass:J,VerticalBlurPass:K,SobelPass:Z,GpuComputePass:$,HysteresisPass:ee,CopyStrongPass:te});var ce=m.a.Option,ue={"BT.601":[.299,.587,.114],"BT.709":[.2126,.7152,.0722],"BT.2100":[.2627,.678,.0593],Mean:[.3333,.3333,.3333]},fe={sobel:{gx:[1,0,-1,2,0,-2,1,0,-1],gy:[1,2,1,0,0,0,-1,-2,-1]},prewitt:{gx:[1,0,-1,1,0,-1,1,0,-1],gy:[1,1,1,0,0,0,-1,-1,-1]}},de=function(){var e=Object(a.useState)(0),t=Object(r.a)(e,2),n=t[0],i=t[1],s=Object(a.useRef)(),l=Object(a.useState)({width:0,height:0}),f=Object(r.a)(l,2),S=f[0],w=f[1],D=Object(a.useState)(null),C=Object(r.a)(D,2),k=C[0],R=C[1],_=Object(a.useState)(null),V=Object(r.a)(_,2),G=V[0],P=V[1],N=Object(a.useState)(!0),Q=Object(r.a)(N,2),B=Q[0],A=Q[1],z=Object(a.useState)(null),L=Object(r.a)(z,2),I=L[0],Y=L[1],X=Object(a.useState)("BT.601"),E=Object(r.a)(X,2),H=E[0],q=E[1],W=Object(a.useState)(ue[H]),J=Object(r.a)(W,2),K=J[0],Z=J[1],$=Object(a.useState)(3),ee=Object(r.a)($,2),te=ee[0],ne=ee[1],re=Object(a.useState)(1),ae=Object(r.a)(re,2),ie=ae[0],se=ae[1],de=Object(a.useState)("sobel"),me=Object(r.a)(de,2),he=me[0],ve=me[1],ge=Object(a.useState)(fe[he]),xe=Object(r.a)(ge,2),je=xe[0],be=xe[1],pe=Object(a.useState)(.3),Oe=Object(r.a)(pe,2),ye=Oe[0],Se=Oe[1],we=Object(a.useState)(.3),De=Object(r.a)(we,2),Ue=De[0],Ce=De[1],ke=Object(a.useState)(1),Me=Object(r.a)(ke,2),Te=Me[0],Fe=Me[1],Re=Object(a.useState)(1),_e=Object(r.a)(Re,2),Ve=_e[0],Ge=_e[1],Pe=Object(a.useState)(null),Ne=Object(r.a)(Pe,2),Qe=Ne[0],Be=Ne[1],Ae=Object(a.useState)(null),ze=Object(r.a)(Ae,2),Le=ze[0],Ie=ze[1],Ye=Object(a.useState)(null),Xe=Object(r.a)(Ye,2),Ee=Xe[0],He=Xe[1],qe=Object(a.useState)(null),We=Object(r.a)(qe,2),Je=We[0],Ke=We[1],Ze=Object(a.useState)(null),$e=Object(r.a)(Ze,2),et=$e[0],tt=$e[1],nt=Object(a.useState)(!1),rt=Object(r.a)(nt,2),at=rt[0],it=rt[1],st=function(e){G&&URL.revokeObjectURL(G),P(e)},lt=function(e){return 0<=e&&e<7},ot={0:Object(U.jsx)(U.Fragment,{children:Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{flex:"120px",children:"Encoding Type"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsxs)(m.a,{defaultValue:H,onChange:function(e){q(e),Z(ue[e])},children:[Object(U.jsx)(ce,{value:"BT.601",children:"BT.601"}),Object(U.jsx)(ce,{value:"BT.709",children:"BT.709"}),Object(U.jsx)(ce,{value:"BT.2100",children:"BT.2100"}),Object(U.jsx)(ce,{value:"Mean",children:"Mean"})]})})]})}),1:Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{flex:"60px",children:"Radius"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{value:te,onChange:function(e){return ne(e)},min:0,max:20})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:te,onChange:function(e){return ne(e)},min:0,max:20})})]}),Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center"},children:[Object(U.jsx)(v.a,{flex:"60px",children:"Sigma (\u03c3)"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{defaultValue:ie,onChange:function(e){return se(e)},min:.01,max:15,step:.01})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:ie,onChange:function(e){return se(e)},min:0,max:20,step:.01})})]})]}),2:Object(U.jsx)(U.Fragment,{children:Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{flex:"70px",children:"Operator"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsxs)(m.a,{defaultValue:he,onChange:function(e){ve(e),be(fe[e])},children:[Object(U.jsx)(ce,{value:"sobel",children:"Sobel"}),Object(U.jsx)(ce,{value:"prewitt",children:"Prewitt"})]})})]})}),3:Object(U.jsx)("p",{children:Object(U.jsx)("i",{children:"(No options available)"})}),4:Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{flex:"60px",children:"High"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{value:Ue,onChange:function(e){return Ce(e)},min:0,max:1,step:.01})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:Ue,onChange:function(e){return Ce(e)},min:0,max:1,step:.01})})]}),Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center"},children:[Object(U.jsx)(v.a,{flex:"60px",children:"Low"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{value:ye,onChange:function(e){return Se(e)},min:0,max:1,step:.01})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:ye,onChange:function(e){return Se(e)},min:0,max:1,step:.01})})]})]}),5:Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{flex:"100px",children:"Tolerance (px)"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{value:Te,onChange:function(e){return Fe(e)},min:0,max:5})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:Te,onChange:function(e){return Fe(e)},min:0,max:5})})]}),Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center"},children:[Object(U.jsx)(v.a,{flex:"100px",children:"Iterations"}),Object(U.jsx)(v.a,{flex:"auto",children:Object(U.jsx)(g.a,{value:Ve,onChange:function(e){return Ge(e)},min:0,max:500})}),Object(U.jsx)(v.a,{flex:"100px",align:"right",children:Object(U.jsx)(x.a,{value:Ve,onChange:function(e){return Ge(e)},min:0,max:500})})]})]})},ct=function(){var e=Object(c.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:et&&(it(!0),new Promise((function(e){setTimeout((function(){var t=et.domElement.toDataURL();e(t)}),30)})).then((function(e){var t=document.createElement("a");t.download="Canny_Step_"+n,t.href=e,t.click(),it(!1)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ut=function(e){if(e){if(e.sobel){for(var t=0,n=Object.entries(e.sobel);t<n.length;t++){var a=Object(r.a)(n[t],2),i=a[0],s=a[1];s&&(s.dispose&&s.dispose(),delete e.sobel[i])}e.sobel=null}if(e.nms){for(var l=0,o=Object.entries(e.nms);l<o.length;l++){var c=Object(r.a)(o[l],2),u=c[0],f=c[1];f&&(f.dispose&&f.dispose(),delete e.nms[u])}e.nms=null}}},ft=function(e,t){var n=Je,r={r:te,s:ie};null==Ee?(He(r),n=oe(r.r,r.s),Ke(n)):r.r==Ee.r&&r.s==Ee.s||(He(r),n=oe(r.r,r.s),Ke(n));var a=n,i=a.length,l=Qe,o={gl:t,dims:[s.current.offsetWidth,s.current.offsetHeight],kernel:je,doNMS:e>2};return null==Le&&(Ie(o),l=le(o.gl,o.dims,o.kernel,o.doNMS),Be(l)),null==I?Y({tg:new T.WebGLRenderTarget(o.dims.x,o.dims.y)}):o.gl==Le.gl&&o.dims[0]==Le.dims[0]&&o.dims[1]==Le.dims[1]&&o.kernel==Le.kernel&&o.doNMS==Le.doNMS||(Ie(o),ut(l),l=le(o.gl,o.dims,o.kernel,o.doNMS),Be(l),o.dims[0]==Le.dims[0]&&o.dims[1]==Le.dims[1]||(I.tg&&(I.tg.dispose&&I.tg.dispose(),delete I.tg),Y({tg:new T.WebGLRenderTarget(o.dims.x,o.dims.y)}))),Object(U.jsxs)(U.Fragment,{children:[e>=0?Object(U.jsx)("grayscalePass",{attachArray:"passes",args:[K]}):null,e>=1?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("horizontalBlurPass",{attachArray:"passes",args:[a,i,s.current.offsetWidth]}),Object(U.jsx)("verticalBlurPass",{attachArray:"passes",args:[a,i,s.current.offsetHeight]})]}):null,2==e?Object(U.jsx)("gpuComputePass",{attachArray:"passes",args:[l.sobel,l.nms,o.dims,!1,null]}):null,3==e?Object(U.jsx)("gpuComputePass",{attachArray:"passes",args:[l.sobel,l.nms,o.dims,!0,null]}):null,e>=4?Object(U.jsx)("gpuComputePass",{attachArray:"passes",args:[l.sobel,l.nms,o.dims,!0,{high:Ue,low:ye}]}):null,e>=5?Object(U.jsx)("hysteresisPass",{attachArray:"passes",args:[Te,Ve,I.tg,o.dims]}):null,e>=6?Object(U.jsx)("copyStrongPass",{attachArray:"passes",args:[o.dims]}):null]})},dt=function(){var e=Object(a.useRef)(),t=Object(u.e)(),r=t.scene,i=t.gl,s=(t.size,t.camera);return i!=et&&tt(i),Object(a.useEffect)((function(){return e.current.render()}),[]),Object(u.c)((function(){return e.current.render()}),1),Object(U.jsxs)("effectComposer",{ref:e,args:[i],children:[Object(U.jsx)("renderPass",{attachArray:"passes",scene:r,camera:s}),ft(n,i)]})};return Object(U.jsxs)("div",{className:"fill-container",children:[Object(U.jsx)(d.a,{visible:B,children:Object(U.jsx)(M,{onLoadCallback:function(e){st(e.src),R(e.dim),A(!1)},style:{display:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reverse,n=void 0!==t&&t,r=e.value,a=void 0===r?"block":r;return n?B?"none":a:B?a:"none"}()}})}),null!=G&&null!=k?Object(U.jsxs)("div",{className:"fill-container",children:[Object(U.jsx)(d.a,{className:"fill-and-vertically-center",children:Object(U.jsxs)(h.a,{gutter:[16,16],justify:"center",align:"middle",style:{display:"flex",alignItems:"center"},children:[Object(U.jsx)(v.a,{className:"process-preview-grid-col",flex:1,children:Object(U.jsx)("div",{className:"process-preview-container",children:Object(U.jsx)("div",{ref:s,children:Object(U.jsx)(j.a,{id:"preview-before",src:G,onLoad:function(){return w({width:s.current.offsetWidth,height:s.current.offsetHeight})}})})})}),Object(U.jsx)(v.a,{className:"process-preview-grid-col",flex:1,children:Object(U.jsx)("div",{className:"process-preview-container",children:Object(U.jsxs)(u.a,{className:"shader",camera:{fov:50,position:[0,0,30]},gl:{preserveDrawingBuffer:!0},style:{position:"relative",width:S.width,height:S.height},children:[Object(U.jsx)(a.Suspense,{fallback:"Loading...",children:Object(U.jsx)(F,{img:G,dim:{width:k.width,height:k.height}})}),Object(U.jsx)(dt,{})]})})}),Object(U.jsxs)(v.a,{className:"process-preview-grid-col",flex:1,style:{alignSelf:"stretch"},children:[Object(U.jsxs)(h.a,{style:{display:"flex",alignItems:"center",paddingBottom:"10px"},children:[Object(U.jsx)(v.a,{children:Object(U.jsx)(b.a,{onClick:function(){return i((function(e){return e-1}))},disabled:!lt(n-1),children:"Previous"})}),Object(U.jsx)(v.a,{flex:"auto",align:"center",children:Object(U.jsx)("h1",{id:"title",style:{display:"inline-block",alignSelf:"center"},children:Object(U.jsx)("b",{children:{0:"Grayscale Encoding",1:"Gaussian Blur",2:"Edgefinding Operation",3:"Non-maximum suppression",4:"Double Threshold",5:"Edge-Tracking (Hysteresis)",6:"Final Image"}[n]})})}),Object(U.jsx)(v.a,{align:"right",style:{paddingRight:"5px"},children:Object(U.jsx)(b.a,{onClick:function(){return i((function(e){return e+1}))},disabled:!lt(n+1),style:{float:"right"},children:"Next"})}),Object(U.jsx)(v.a,{align:"right",children:Object(U.jsx)(b.a,{type:"primary",onClick:ct,style:{float:"right"},children:at?Object(U.jsx)(p.a,{size:"middle",indicator:Object(U.jsx)(O.a,{spin:!0,style:{color:"white"}})}):"Save"})})]}),function(e){return Object(U.jsx)("div",{className:"processor-options",children:ot[e]})}(n)]})]})}),Object(U.jsx)(d.a,{className:"back-overlay",visible:!B,children:Object(U.jsxs)(b.a,{id:"button",type:"link",style:{fontSize:"15px"},onClick:function(){ut(Qe),st(null),R(null),A(!0)},children:[Object(U.jsx)(y.a,{}),"Change image"]})})]}):null]})};t.default=function(){var e=Object(a.useState)(!1),t=Object(r.a)(e,2),n=t[0],l=t[1];return!1===n&&(i.a.open({message:"This project works best on a powerful machine!",description:Object(U.jsxs)("span",{children:["This page uses WebGL - a dedicated GPU is STRONGLY recommended.",Object(U.jsx)("br",{}),"Loading images which are too large or updating parameters too quickly ",Object(U.jsx)("i",{children:"may"})," cause the browser to run out of memory."]}),icon:Object(U.jsx)(s.a,{twoToneColor:"#FFA500"}),key:"performance-notif",style:{width:500}}),l(!0)),Object(U.jsx)("div",{className:"fill-container",children:de()})}}}]);
//# sourceMappingURL=21.b8d596e4.chunk.js.map